{% extends 'base.html' %}

{% block title %}Razones de Liquidez - DicksonStatistics{% endblock %}

{% block extra_css %}
<style>
  :root {
    --primary: #00d9ff;
    --secondary: #0099cc;
    --accent: #ff006e;
    --dark-bg: #0a0e27;
    --card-bg: #1a1f3a;
    --border-color: #2d3561;
    --text-primary: #e0e0e0;
    --text-secondary: #a0a0a0;
    --success: #00ff88;
    --warning: #ffaa00;
    --danger: #ff3366;
  }

  .section-header {
    background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(255, 0, 110, 0.1) 100%);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    padding: 40px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
  }

  .section-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 200%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0, 217, 255, 0.1), transparent);
    animation: shimmer 3s infinite;
  }

  @keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
  }

  @keyframes pulseGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(0, 217, 255, 0.3); }
    50% { box-shadow: 0 0 40px rgba(0, 217, 255, 0.6); }
  }

  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.9);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .section-title {
    font-size: 2rem;
    font-weight: 800;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 15px;
    position: relative;
    z-index: 1;
  }

  .section-subtitle {
    color: var(--text-secondary);
    font-size: 1.1rem;
    position: relative;
    z-index: 1;
  }

  .card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 15px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    margin-bottom: 30px;
    animation: slideInUp 0.6s ease-out;
  }

  .card:hover {
    border-color: var(--primary);
    box-shadow: 0 12px 48px rgba(0, 217, 255, 0.2);
    transform: translateY(-5px);
  }

  .card-header {
    background: linear-gradient(90deg, rgba(0, 217, 255, 0.1), rgba(255, 0, 110, 0.1));
    border-bottom: 1px solid var(--border-color);
    border-radius: 15px 15px 0 0;
    padding: 20px;
    font-weight: 600;
    color: var(--primary);
  }

  .card-body {
    padding: 25px;
  }

  .btn-primary-glow {
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    border: none;
    color: var(--dark-bg);
    font-weight: 600;
    border-radius: 10px;
    padding: 12px 24px;
    transition: all 0.3s ease;
    box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
    cursor: pointer;
  }

  .btn-primary-glow:hover {
    box-shadow: 0 0 40px rgba(0, 217, 255, 0.6);
    transform: translateY(-2px);
    color: var(--dark-bg);
  }

  .btn-danger-glow {
    background: var(--danger);
    border: none;
    color: white;
    font-weight: 600;
    border-radius: 10px;
    padding: 12px 24px;
    transition: all 0.3s ease;
    box-shadow: 0 0 20px rgba(255, 0, 110, 0.3);
    cursor: pointer;
  }

  .btn-danger-glow:hover {
    box-shadow: 0 0 40px rgba(255, 0, 110, 0.6);
    transform: translateY(-2px);
    color: white;
  }

  .input-futurista {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    border-radius: 10px;
    padding: 12px 15px;
    transition: all 0.3s ease;
  }

  .input-futurista:focus {
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--primary);
    box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);
    color: var(--text-primary);
  }

  .input-futurista::placeholder {
    color: var(--text-secondary);
  }

  .metric-card {
    background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(255, 0, 110, 0.05));
    border: 1px solid var(--border-color);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 20px;
    transition: all 0.3s ease;
    animation: fadeInScale 0.6s ease-out;
  }

  .metric-card:hover {
    border-color: var(--primary);
    box-shadow: 0 8px 32px rgba(0, 217, 255, 0.15);
    animation: pulseGlow 2s ease-in-out infinite;
  }

  .metric-value {
    font-size: 2.5rem;
    font-weight: 900;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .metric-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 8px;
  }

  .metric-interpretation {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--border-color);
  }

  .badge-estado {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.85rem;
    margin-top: 10px;
    animation: fadeInScale 0.6s ease-out;
  }

  .badge-excelente {
    background: rgba(0, 255, 136, 0.2);
    color: var(--success);
    border: 1px solid var(--success);
  }

  .badge-aceptable {
    background: rgba(255, 170, 0, 0.2);
    color: var(--warning);
    border: 1px solid var(--warning);
  }

  .badge-deficiente {
    background: rgba(255, 51, 102, 0.2);
    color: var(--danger);
    border: 1px solid var(--danger);
  }

  .control-panel {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    align-items: flex-end;
    animation: slideInUp 0.6s ease-out;
  }

  .formula-box {
    background: rgba(0, 217, 255, 0.05);
    border-left: 4px solid var(--primary);
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
    font-family: 'Courier New', monospace;
    color: var(--text-primary);
    font-size: 0.95rem;
  }

  .interpretacion-box {
    background: rgba(255, 0, 110, 0.05);
    border-left: 4px solid var(--accent);
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .nav-tabs .nav-link {
    color: var(--text-secondary);
    border: none;
    border-bottom: 3px solid transparent;
    border-radius: 0;
    padding: 15px 20px;
    transition: all 0.3s ease;
  }

  .nav-tabs .nav-link:hover {
    color: var(--primary);
    border-bottom-color: var(--primary);
  }

  .nav-tabs .nav-link.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
    background: transparent;
  }

  .monto-editable {
    background: rgba(0, 217, 255, 0.1);
    border: 1px solid var(--primary);
    border-radius: 5px;
    padding: 8px 12px;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
  }

  .monto-editable:hover {
    background: rgba(0, 217, 255, 0.2);
    box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
  }

  .input-monto-modal {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid var(--primary);
    color: var(--text-primary);
    border-radius: 10px;
    padding: 12px 15px;
    font-size: 1.2rem;
    font-weight: 600;
    width: 100%;
    text-align: right;
  }

  .input-monto-modal:focus {
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
    outline: none;
  }

  .modal-content {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 15px;
  }

  .modal-header {
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(90deg, rgba(0, 217, 255, 0.1), rgba(255, 0, 110, 0.1));
  }

  .modal-header .btn-close {
    filter: invert(1);
  }

  .modal-title {
    color: var(--primary);
    font-weight: 700;
  }

  .modal-body {
    color: var(--text-primary);
  }

  .tabla-liquidez {
    width: 100%;
    border-collapse: collapse;
  }

  .tabla-liquidez td {
    padding: 12px 15px;
    border: none;
    color: var(--text-primary);
  }

  .tabla-liquidez .concepto {
    text-align: left;
    font-weight: 500;
    min-width: 200px;
  }

  .tabla-liquidez .valor {
    text-align: right;
    min-width: 120px;
  }

  .tabla-liquidez .subtotal {
    background: rgba(0, 217, 255, 0.05);
    font-weight: 600;
    border-bottom: 1px dashed var(--border-color);
  }

  .chart-container {
    position: relative;
    height: 400px;
    margin: 20px 0;
    animation: fadeInScale 0.8s ease-out;
  }

  .chart-container-small {
    position: relative;
    height: 300px;
    margin: 20px 0;
    animation: fadeInScale 0.8s ease-out;
  }

  .chart-wrapper {
    background: rgba(0, 217, 255, 0.02);
    border: 1px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .chart-title {
    color: var(--primary);
    font-weight: 700;
    margin-bottom: 15px;
    font-size: 1.1rem;
  }

  @media (max-width: 768px) {
    .section-title {
      font-size: 1.5rem;
    }

    .metric-value {
      font-size: 1.8rem;
    }

    .section-header {
      padding: 25px;
    }

    .control-panel {
      flex-direction: column;
    }

    .control-panel > * {
      width: 100%;
    }

    .chart-container {
      height: 300px;
    }

    .chart-container-small {
      height: 250px;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid p-4" style="position: relative; z-index: 1;">
  <section class="section-header">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <h1 class="section-title"><i class="fas fa-water" style="margin-right: 15px; text-shadow: 0 0 20px rgba(0, 217, 255, 0.5);"></i>An√°lisis de Razones de Liquidez</h1>
        <p class="section-subtitle">Eval√∫a la capacidad de tu empresa para cumplir con sus obligaciones de corto plazo</p>
      </div>
      <div class="col-lg-4 text-center">
        <div style="font-size: 4rem; color: var(--primary); text-shadow: 0 0 30px rgba(0, 217, 255, 0.5);">
          <i class="fas fa-chart-pie"></i>
        </div>
      </div>
    </div>
  </section>

  <div class="control-panel">
    <div style="flex: 1; min-width: 250px;">
      <label style="color: var(--primary); font-weight: 700; display: block; margin-bottom: 8px;">Per√≠odo a Analizar</label>
      <select id="periodSeleccionado" class="input-futurista" style="width: 100%;">
        <option value="2022">2022</option>
        <option value="2023" selected>2023</option>
        <option value="2024">2024</option>
      </select>
    </div>
    <button class="btn btn-primary-glow" onclick="actualizarLiquidez()" style="align-self: flex-end;">
      <i class="fas fa-sync"></i> Actualizar
    </button>
    <button class="btn btn-danger-glow" onclick="limpiarDatosLiquidez()" style="align-self: flex-end;">
      <i class="fas fa-trash"></i> Limpiar
    </button>
  </div>

  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-datos" data-bs-toggle="tab" data-bs-target="#contenido-datos" type="button">
        <i class="fas fa-database"></i> Datos del Balance
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-razones" data-bs-toggle="tab" data-bs-target="#contenido-razones" type="button">
        <i class="fas fa-calculator"></i> C√°lculo de Razones
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-graficos" data-bs-toggle="tab" data-bs-target="#contenido-graficos" type="button">
        <i class="fas fa-chart-bar"></i> Gr√°ficos
      </button>
    </li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane fade show active" id="contenido-datos" role="tabpanel">
      <h2 style="font-size: 1.8rem; font-weight: 800; color: var(--primary); margin-top: 30px; margin-bottom: 30px; border-bottom: 2px solid var(--primary); padding-bottom: 15px;">
        <i class="fas fa-database"></i> Datos del Balance General
      </h2>

      <div class="row">
        <div class="col-lg-6">
          <div class="card">
            <div class="card-header">
              <i class="fas fa-coins"></i> Activos Circulantes
            </div>
            <div class="card-body">
              <table class="tabla-liquidez">
                <tbody>
                  <tr>
                    <td class="concepto">Efectivo</td>
                    <td class="valor"><span class="monto-editable" onclick="abrirModalEdicion('efectivo')">0.00</span></td>
                  </tr>
                  <tr>
                    <td class="concepto">Cuentas por Cobrar</td>
                    <td class="valor"><span class="monto-editable" onclick="abrirModalEdicion('cuentasPorCobrar')">0.00</span></td>
                  </tr>
                  <tr>
                    <td class="concepto">Inventarios</td>
                    <td class="valor"><span class="monto-editable" onclick="abrirModalEdicion('inventarios')">0.00</span></td>
                  </tr>
                  <tr class="subtotal">
                    <td class="concepto"><strong>Total Activos Circulantes</strong></td>
                    <td class="valor"><strong id="totalActivoCirculante">0.00</strong></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card">
            <div class="card-header">
              <i class="fas fa-credit-card"></i> Pasivos Circulantes
            </div>
            <div class="card-body">
              <table class="tabla-liquidez">
                <tbody>
                  <tr>
                    <td class="concepto">Cuentas por Pagar</td>
                    <td class="valor"><span class="monto-editable" onclick="abrirModalEdicion('cuentasPorPagar')">0.00</span></td>
                  </tr>
                  <tr>
                    <td class="concepto">Deuda Corto Plazo</td>
                    <td class="valor"><span class="monto-editable" onclick="abrirModalEdicion('deudaCortoPlazo')">0.00</span></td>
                  </tr>
                  <tr>
                    <td class="concepto">Otros Pasivos</td>
                    <td class="valor"><span class="monto-editable" onclick="abrirModalEdicion('otrosPasivos')">0.00</span></td>
                  </tr>
                  <tr class="subtotal">
                    <td class="concepto"><strong>Total Pasivos Circulantes</strong></td>
                    <td class="valor"><strong id="totalPasivoCirculante">0.00</strong></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="contenido-razones" role="tabpanel">
      <h2 style="font-size: 1.8rem; font-weight: 800; color: var(--primary); margin-top: 30px; margin-bottom: 30px; border-bottom: 2px solid var(--primary); padding-bottom: 15px;">
        <i class="fas fa-calculator"></i> Razones de Liquidez Calculadas
      </h2>

      <div class="card">
        <div class="card-header">
          <i class="fas fa-briefcase"></i> 1. Capital Neto de Trabajo (CNT)
        </div>
        <div class="card-body">
          <div class="formula-box">
            <strong>F√≥rmula:</strong><br>
            CNT = Activos Circulantes - Pasivos Circulantes
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="metric-card">
                <div class="metric-value" id="valorCNT">0.00</div>
                <div class="metric-label">Capital Neto de Trabajo</div>
                <div id="estadoCNT" class="badge-estado badge-aceptable"></div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="interpretacion-box">
                <strong>üìä Interpretaci√≥n:</strong><br>
                ‚Ä¢ <strong>Positivo:</strong> Suficientes activos para cubrir pasivos<br>
                ‚Ä¢ <strong>Negativo:</strong> Posible problema de liquidez<br>
                ‚Ä¢ <strong>Ideal:</strong> 10-20% de las ventas anuales
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <i class="fas fa-balance-scale"></i> 2. Raz√≥n Circulante
        </div>
        <div class="card-body">
          <div class="formula-box">
            <strong>F√≥rmula:</strong><br>
            Raz√≥n Circulante = Activos Circulantes √∑ Pasivos Circulantes
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="metric-card">
                <div class="metric-value" id="valorRazonCirculante">0.00</div>
                <div class="metric-label">Raz√≥n Circulante (veces)</div>
                <div id="estadoRazonCirculante" class="badge-estado badge-aceptable"></div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="interpretacion-box">
                <strong>üìä Interpretaci√≥n:</strong><br>
                ‚Ä¢ <strong>Ideal:</strong> 1.5 - 2.0 veces<br>
                ‚Ä¢ <strong>Aceptable:</strong> Mayor a 1.0<br>
                ‚Ä¢ <strong>Menor a 1.0:</strong> Riesgo de insolvencia
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <i class="fas fa-flask"></i> 3. Prueba √Åcida
        </div>
        <div class="card-body">
          <div class="formula-box">
            <strong>F√≥rmula:</strong><br>
            Prueba √Åcida = (Activos Circulantes - Inventarios) √∑ Pasivos Circulantes
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="metric-card">
                <div class="metric-value" id="valorPruebaAcida">0.00</div>
                <div class="metric-label">Prueba √Åcida (veces)</div>
                <div id="estadoPruebaAcida" class="badge-estado badge-aceptable"></div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="interpretacion-box">
                <strong>üìä Interpretaci√≥n:</strong><br>
                ‚Ä¢ <strong>Ideal:</strong> 1.0 - 1.2 veces<br>
                ‚Ä¢ <strong>Aceptable:</strong> 0.8 - 1.5 veces<br>
                ‚Ä¢ <strong>Uso:</strong> M√°s conservador que raz√≥n circulante
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="contenido-graficos" role="tabpanel">
      <h2 style="font-size: 1.8rem; font-weight: 800; color: var(--primary); margin-top: 30px; margin-bottom: 30px; border-bottom: 2px solid var(--primary); padding-bottom: 15px;">
        <i class="fas fa-chart-bar"></i> Visualizaci√≥n de Datos
      </h2>

      <div class="row">
        <div class="col-lg-6">
          <div class="chart-wrapper">
            <div class="chart-title">üìä Composici√≥n de Activos Circulantes</div>
            <div class="chart-container-small">
              <canvas id="chartActivosComposicion"></canvas>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="chart-wrapper">
            <div class="chart-title">üí≥ Composici√≥n de Pasivos Circulantes</div>
            <div class="chart-container-small">
              <canvas id="chartPasivosComposicion"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-lg-12">
          <div class="chart-wrapper">
            <div class="chart-title">‚öñÔ∏è Activos Circulantes vs Pasivos Circulantes</div>
            <div class="chart-container">
              <canvas id="chartActivosPasivos"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalEdicion" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-edit"></i> Editar Valor</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <label class="form-label" style="color: var(--primary); font-weight: 700;" id="labelConcepto"></label>
        <input type="number" id="inputValor" class="input-monto-modal" placeholder="0.00" step="0.01">
      </div>
      <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary-glow" onclick="guardarEdicionLiquidez()">
          <i class="fas fa-save"></i> Guardar
        </button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<script>
  let chartActivosComposicion, chartPasivosComposicion, chartActivosPasivos;

  let datosLiquidez = {
    2022: {
      efectivo: 50000,
      cuentasPorCobrar: 75000,
      inventarios: 100000,
      cuentasPorPagar: 60000,
      deudaCortoPlazo: 40000,
      otrosPasivos: 20000
    },
    2023: {
      efectivo: 60000,
      cuentasPorCobrar: 85000,
      inventarios: 110000,
      cuentasPorPagar: 70000,
      deudaCortoPlazo: 45000,
      otrosPasivos: 25000
    },
    2024: {
      efectivo: 70000,
      cuentasPorCobrar: 95000,
      inventarios: 120000,
      cuentasPorPagar: 80000,
      deudaCortoPlazo: 50000,
      otrosPasivos: 30000
    }
  };

  let conceptoActual = null;

  const coloresFuturistas = {
    primary: '#00d9ff',
    secondary: '#0099cc',
    accent: '#ff006e',
    success: '#00ff88',
    warning: '#ffaa00',
    danger: '#ff3366',
    dark: '#0a0e27',
    cardBg: '#1a1f3a'
  };

  function abrirModalEdicion(concepto) {
    conceptoActual = concepto;
    const periodo = document.getElementById('periodSeleccionado').value;
    const valor = datosLiquidez[periodo][concepto] || 0;
    
    const etiquetas = {
      'efectivo': 'Efectivo',
      'cuentasPorCobrar': 'Cuentas por Cobrar',
      'inventarios': 'Inventarios',
      'cuentasPorPagar': 'Cuentas por Pagar',
      'deudaCortoPlazo': 'Deuda Corto Plazo',
      'otrosPasivos': 'Otros Pasivos'
    };

    document.getElementById('labelConcepto').textContent = `${etiquetas[concepto]} - ${periodo}`;
    document.getElementById('inputValor').value = valor;
    
    const modal = new bootstrap.Modal(document.getElementById('modalEdicion'));
    modal.show();
    
    setTimeout(() => {
      document.getElementById('inputValor').focus();
      document.getElementById('inputValor').select();
    }, 300);
  }

  function guardarEdicionLiquidez() {
    const valor = parseFloat(document.getElementById('inputValor').value) || 0;
    const periodo = document.getElementById('periodSeleccionado').value;
    datosLiquidez[periodo][conceptoActual] = valor;
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('modalEdicion'));
    modal.hide();
    
    actualizarLiquidez();
  }

  function calcularTotales() {
    const periodo = document.getElementById('periodSeleccionado').value;
    const datos = datosLiquidez[periodo];

    const totalAC = datos.efectivo + datos.cuentasPorCobrar + datos.inventarios;
    const totalPC = datos.cuentasPorPagar + datos.deudaCortoPlazo + datos.otrosPasivos;

    return { totalAC, totalPC, datos };
  }

  function obtenerEstado(valor, minimo, maximo) {
    if (valor >= minimo && valor <= maximo) {
      return { clase: 'badge-excelente', texto: '‚úì Excelente' };
    } else if (valor >= minimo * 0.8 && valor <= maximo * 1.2) {
      return { clase: 'badge-aceptable', texto: '‚ö† Aceptable' };
    } else {
      return { clase: 'badge-deficiente', texto: '‚úó Deficiente' };
    }
  }

  function crearGraficoActivosComposicion(datos, totalAC) {
    const ctx = document.getElementById('chartActivosComposicion');
    if (!ctx) return;
    
    if (chartActivosComposicion) {
      chartActivosComposicion.destroy();
    }

    chartActivosComposicion = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Efectivo', 'Cuentas por Cobrar', 'Inventarios'],
        datasets: [{
          data: [datos.efectivo, datos.cuentasPorCobrar, datos.inventarios],
          backgroundColor: [
            coloresFuturistas.success,
            coloresFuturistas.primary,
            coloresFuturistas.warning
          ],
          borderColor: [
            coloresFuturistas.success,
            coloresFuturistas.primary,
            coloresFuturistas.warning
          ],
          borderWidth: 2,
          hoverOffset: 10
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#e0e0e0',
              font: { size: 12, weight: 'bold' },
              padding: 15
            }
          }
        }
      }
    });
  }

  function crearGraficoPasivosComposicion(datos, totalPC) {
    const ctx = document.getElementById('chartPasivosComposicion');
    if (!ctx) return;
    
    if (chartPasivosComposicion) {
      chartPasivosComposicion.destroy();
    }

    chartPasivosComposicion = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Cuentas por Pagar', 'Deuda Corto Plazo', 'Otros Pasivos'],
        datasets: [{
          data: [datos.cuentasPorPagar, datos.deudaCortoPlazo, datos.otrosPasivos],
          backgroundColor: [
            coloresFuturistas.danger,
            coloresFuturistas.accent,
            coloresFuturistas.warning
          ],
          borderColor: [
            coloresFuturistas.danger,
            coloresFuturistas.accent,
            coloresFuturistas.warning
          ],
          borderWidth: 2,
          hoverOffset: 10
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#e0e0e0',
              font: { size: 12, weight: 'bold' },
              padding: 15
            }
          }
        }
      }
    });
  }

  function crearGraficoActivosPasivos(totalAC, totalPC) {
    const ctx = document.getElementById('chartActivosPasivos');
    if (!ctx) return;
    
    if (chartActivosPasivos) {
      chartActivosPasivos.destroy();
    }

    chartActivosPasivos = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Activos Circulantes', 'Pasivos Circulantes'],
        datasets: [{
          label: 'Monto',
          data: [totalAC, totalPC],
          backgroundColor: [
            coloresFuturistas.success,
            coloresFuturistas.danger
          ],
          borderColor: [
            coloresFuturistas.success,
            coloresFuturistas.danger
          ],
          borderWidth: 2,
          borderRadius: 10
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          x: {
            ticks: { color: '#e0e0e0' },
            grid: { color: 'rgba(0, 217, 255, 0.1)' }
          },
          y: {
            ticks: { color: '#e0e0e0' },
            grid: { color: 'rgba(0, 217, 255, 0.1)' }
          }
        }
      }
    });
  }

  function actualizarLiquidez() {
    const { totalAC, totalPC, datos } = calcularTotales();

    document.getElementById('totalActivoCirculante').textContent = totalAC.toLocaleString('es-ES', { minimumFractionDigits: 2 });
    document.getElementById('totalPasivoCirculante').textContent = totalPC.toLocaleString('es-ES', { minimumFractionDigits: 2 });

    const cnt = totalAC - totalPC;
    document.getElementById('valorCNT').textContent = cnt.toLocaleString('es-ES', { minimumFractionDigits: 2 });
    const estadoCNT = cnt > 0 ? 'badge-excelente' : 'badge-deficiente';
    document.getElementById('estadoCNT').className = `badge-estado ${estadoCNT}`;
    document.getElementById('estadoCNT').textContent = cnt > 0 ? '‚úì Positivo' : '‚úó Negativo';

    const razonCirculante = totalPC > 0 ? (totalAC / totalPC).toFixed(2) : 0;
    document.getElementById('valorRazonCirculante').textContent = razonCirculante;
    const estadoRC = obtenerEstado(parseFloat(razonCirculante), 1.5, 2.0);
    document.getElementById('estadoRazonCirculante').className = `badge-estado ${estadoRC.clase}`;
    document.getElementById('estadoRazonCirculante').textContent = estadoRC.texto;

    const activosLiquidos = totalAC - datos.inventarios;
    const pruebaAcida = totalPC > 0 ? (activosLiquidos / totalPC).toFixed(2) : 0;
    document.getElementById('valorPruebaAcida').textContent = pruebaAcida;
    const estadoPA = obtenerEstado(parseFloat(pruebaAcida), 1.0, 1.2);
    document.getElementById('estadoPruebaAcida').className = `badge-estado ${estadoPA.clase}`;
    document.getElementById('estadoPruebaAcida').textContent = estadoPA.texto;

    crearGraficoActivosComposicion(datos, totalAC);
    crearGraficoPasivosComposicion(datos, totalPC);
    crearGraficoActivosPasivos(totalAC, totalPC);
  }

  function limpiarDatosLiquidez() {
    const periodo = document.getElementById('periodSeleccionado').value;
    datosLiquidez[periodo] = {
      efectivo: 0,
      cuentasPorCobrar: 0,
      inventarios: 0,
      cuentasPorPagar: 0,
      deudaCortoPlazo: 0,
      otrosPasivos: 0
    };
    actualizarLiquidez();
  }

  document.addEventListener('DOMContentLoaded', actualizarLiquidez);
</script>
{% endblock %}


